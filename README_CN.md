# AF2Location

AF2Location 是一个轻量级的 Android 桥接工具，用于将 **Aerofly FS 2** 和 **Aerofly FS 4** 的飞行遥测数据转发给 Android 系统的 **模拟位置** 服务。

该应用允许 Android 操作系统将飞行模拟器的虚拟坐标识别为设备的物理位置。因此，运行在该设备上的任何基于位置的应用（如导航软件、地图工具等）都能实时跟踪模拟飞机的当前位置。

## 核心功能

本应用执行以下四项特定任务：
1.  **UDP 监听**：监听 Aerofly FS 在指定端口广播的 `XGPS` 遥测字符串。
2.  **数据解析**：提取经度、纬度、高度、航向和地速。
3.  **信号处理**：对坐标数据应用一维卡尔曼滤波，以减轻模拟器 4 位小数输出固有的约 11 米量化噪声。
4.  **系统注入**：将处理后的数据作为测试提供程序注入 Android `LocationManager`，并包含精确的原始航向数据以支持侧风飞行（蟹行）时的姿态显示。

## 环境要求

* **PC**：安装 Aerofly FS 2 或 Aerofly FS 4。
* **Android**：运行 Android 13 (Tiramisu) 或更高版本的设备。
* **网络**：PC 和 Android 设备必须处于同一局域网 (LAN/WLAN) 下。

## 配置指南

### 1. PC 端 (Aerofly FS)

需要在模拟器设置中启用遥测广播。

1.  打开 Aerofly FS。
2.  进入 **设置** -> **其它参数**。
3.  找到 **广播飞行信息至IP地址** 选项并将其切换为 **开启**。
4.  确认或配置以下参数（通常为默认值）：
    * **广播IP地址**: `192.168.1.255` (默认广播地址，或填写你设备的具体 IP)。
    * **广播IP端口**: `49002` (默认)。

### 2. Android 端

为了允许本应用注入 GPS 数据，必须启用开发者选项：

1.  进入 **设置** -> **关于手机**。
2.  连续点击 **版本号** 7 次以启用开发者选项。
3.  进入 **系统** -> **开发者选项**。
4.  向下滚动找到 **选择模拟位置信息应用**。
5.  选择 **AF2Location**。

## 使用方法

1.  启动 AF2Location。
2.  输入 Aerofly FS 中配置的 UDP 端口（默认：`49002`）。
3.  点击 **启动后台服务**。
4.  授予请求的位置和通知权限。
    * *注意：必须选择“始终允许”或“仅在使用该应用时允许”。*
5.  状态将显示在通知栏中。你现在可以切换到任何其他地图应用。

要停止服务，请打开 App 点击 **停止服务**，或使用通知栏中的操作按钮。

## 构建信息

本项目使用标准 Android Studio 和 Gradle 构建。

* 语言: Kotlin
* Min SDK: 33 (Android 13 Tiramisu)
* Target SDK: 36 (Android 16 Baklava)

## 许可证

MIT License

## 免责声明

本软件仅供 **飞行模拟娱乐使用**。请勿在真实航空导航、驾驶或任何涉及安全的场景中使用模拟位置功能。